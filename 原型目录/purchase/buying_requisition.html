<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>请购</title>
<link rel="stylesheet" type="text/css"
	href="../extjs/resources/css/ext-all.css" />
<script type="text/javascript" src="../extjs/ext-all.js"></script>
<script type="text/javascript" src="../extjs/ext-lang-zh_CN.js"></script>
<script>
Ext.onReady(function(){
	Ext.BLANK_IMAGE_URL = "extjs/resources/images/default/s.gif";
		  Ext.QuickTips.init();
		windowst.show();
	});
		
	 Ext.define('User', {
	     extend: 'Ext.data.Model',
	     fields: [
	         {name: 'flag', type: 'string'},
	          {name: 'billno', type: 'string'},
	           {name: 'billdate', type: 'string'}
	     ]
	 });
	 var store = Ext.create('Ext.data.Store', {
	     model: 'User',
	     proxy: {
	         type: 'ajax',
	         url: 'http://127.0.0.1:8080/purchase/getPurchase',
	         reader: {
	             type: 'json',
	             root: 'data'
	         }
	     },
	     autoLoad: true
	 });

	var grids2 = Ext.create('Ext.grid.Panel', {
		plugins: [
			Ext.create('Ext.grid.plugin.CellEditing', {
				clicksToEdit: 1
			})
		],
		columns: [{
				header: '',
				xtype: 'rownumberer',
				dataIndex: 'lh'
			},

			{
				header: '(---)',
				dataIndex: 'name',
				width:50
			}
		],
		height: '100%',
		width: '100%'
	})
	
	var filterPanel = Ext.create('Ext.panel.Panel', {
		width: 218,
		height: 168,
		border:false,
		items: [grids2],
		bbar: [{
				xtype: "label",
				text: '总计:',
				width: 90
			},
			{
				xtype: "textfield",
				disabled: true,
				width: 90,
				margin: '0 180',
				value: '0.00'
			},
			{
				xtype: "textfield",
				disabled: true,
				width: 90,
				margin: '0',
				value: '0.00'
			},
			{
				xtype: "textfield",
				disabled: true,
				width: 90,
				margin: '0 40 0 30',
				value: '0.00'
			},
			{
				xtype: "textfield",
				disabled: true,
				width: 90,
				margin: '0 0 0 0',
				value: '0.00'
			}
		],
	});
			
	var grids = Ext.create('Ext.grid.Panel', {
			
			plugins: [
				Ext.create('Ext.grid.plugin.CellEditing', {
					clicksToEdit: 1
				})
			],
			columns: [{
					header: '',
					xtype: 'rownumberer',
					dataIndex: 'lh'
				},

				{
					header: '(---)',
					dataIndex: 'name',
					width:50
				}
			],
			height: 165,
			width: 130
	})
	
		var fielmenu2=new Ext.menu.Menu({
			items:[{text:'销售订单转入',handler:function(){
				mainWindow1.show();
			}}]
		});
		
		
		var fielmenu3=new Ext.menu.Menu({
			items:[{text:'单况状态切换',handler:function(){
				var text =  Ext.getCmp("notestate").getValue();
				if(text=="未结案"){
					  Ext.getCmp("notestate").setValue("已结案");
				}else if(text=="已结案"){
					Ext.getCmp("notestate").setValue("无效");
				}else if(text=="无效"){
					Ext.getCmp("notestate").setValue("未结案");
				}
			  
			}}],
		});




var grids=Ext.create('Ext.grid.Panel',{
    
	 listeners:{
				containerdblclick: function(grid, e, eOpts){ //单击事件
	    						grid.getStore().add({'name':'12', 'dizhi':'','bianma':'','lianxi':''});
    						
    					},
					itemcontextmenu:function(){
					
    						e.preventDefault();
    						new Ext.menu.Menu({
    							items:[{
    								xtype: 'textfield',
    								text: 'Lost',
    								pressed: false,
    								handler:function(){
											alert();
										}
    							},{
    								xtype: '',
    								text: '娓呴櫎鏂规',
    								pressed: false,
    								handler: function(){}
    							},{
    								xtype: '',
    								text: '閫夋嫨鏂规',
    								pressed: false,
    								menu:new Ext.menu.Menu({
    									items:[{
    										text:'棰勮鏂规',
    										pressed: false
    									}]
    								}),
    								handler: function(){}
    							},{
    								xtype: '',
    								text: '瀵煎嚭鑷矱xcel',
    								pressed: false,
    								handler: function(){}
    							},{
    								xtype: '',
    								text: '缃戞牸鎵撳嵃',
    								pressed: false,
    								handler: function(){}
    							}]
    						}
    						
    						).showAt(e.getXY());
				}
			},plugins: [
        				Ext.create('Ext.grid.plugin.CellEditing', {
            				clicksToEdit: 1
        				})
    				],
	columns: [
				 {header: '（栏号）',
	                    		xtype: 'rownumberer',
	                    		dataIndex: 'lh', 
	                    		width: 50,
								sortable: false
        					},
					
        		{ header: '物料编号',  dataIndex: 'name', width: 100,},
       			 { header: '物料名称', dataIndex: 'dizhi',width: 120,editor: { xtype:'textfield',
				 	listeners:{
						focus:function(grid, e, eOpts){
								windows2.show();
								}
							
					}
				 } },
       				 { header: '规格型号', dataIndex: 'bianma' },
					 { header: '单位名称', dataIndex: 'lianxi' },
					 { header: '数量', dataIndex: 'lianxi'},
					 { header: '(币别)', dataIndex: 'lianxi' },
					 { header: '(标准进价)', dataIndex: 'lianxi' },
					 { header: '(标准进价金额)', dataIndex: 'lianxi' },
					 { header: '(币别)', dataIndex: 'lianxi' },
					 { header: '(单价)', dataIndex: 'lianxi' },
					 { header: '(进价金额)', dataIndex: 'lianxi' },
					 { header: '需求日期', dataIndex: 'lianxi' },
					 { header: '(建议采购日期)', dataIndex: 'lianxi' },
					 { header: '(未采购量)', dataIndex: 'lianxi' },
					 { header: '分录备注', dataIndex: 'lianxi' },
					 { header: '来源单别', dataIndex: 'lianxi' },
					 { header: '来源单号', dataIndex: 'lianxi' },
   					 ],
   			 height: 130,
			 width:1971,
			 autoScroll:false,
			 
})

var filterPanel = Ext.create('Ext.panel.Panel', {
    bodyPadding: 6,  // 避免Panel中的子元素紧邻边框
    width: 1985,
	height:170,
    items:[grids],
	bbar:[{xtype:"label",text:'总计:',width:90},
	{xtype:"textfield",disabled:true,width:90,margin:'0 180',value:'0.00'},
	{xtype:"textfield",disabled:true,width:90,margin:'0',value:'0.00'},
	{xtype:"textfield",disabled:true,width:90,margin:'0 40 0 30',value:'0.00'},
	{xtype:"textfield",disabled:true,width:90,margin:'0 0 0 0',value:'0.00'}],
});

var text1 = Ext.create('Ext.form.Panel', {
    width: 300,
    bodyPadding: 10,
    renderTo: Ext.getBody(),
    items: [{
        xtype: 'textfield',
        name: 'name',
        fieldLabel: '表头条纹',
        allowBlank: false  // 表单项非空
    }, {
        xtype: 'textfield',
        name: 'email',
        fieldLabel: '自定义栏一',
        vtype: 'email'  // 表单项需填email格式
    }]
});



var formsg=Ext.create('Ext.form.Panel', {
    bodyPadding: 5,
	height:'100%',
	layout:"column",
	baseCls:'x-plain',
	items:[{
				style:'margin-left:9px;color:blue',
				xtype: 'textfield',
		        name: 'SalesMan',
				bodyPadding: 5,
		        fieldLabel: '请购人员',
				width:250,
		        labelWidth: 80,
	        	anchor: '100%',
			},{
				 xtype: 'textfield',
		        name: 'Marker',
		        fieldLabel: '制单人员',
				style:'margin-left:19px',
				width:250,
		        labelWidth: 80,
		        anchor: '100%',
			},{
				style:'margin-left:9px;color:blue',
				 xtype: 'textfield',
		        name: 'ProdDepart',
		        fieldLabel: '请购部门',
				width:250,
		        labelWidth: 80,
		        anchor: '100%',
		        enableKeyEvents: true,
		        listeners: {
					render: function(field) {
						Ext.QuickTips.init();
						Ext.QuickTips.register({
							target: field.el,
							text: '按F4选择客户'
						})
					},
					keyup: function(textField, e) {
						if(e.getKey() == 115) {
							//定义读取数据格式
						    /*var dataReader = new Ext.data.JsonReader({
						         root: 'data'
						    },[
						             { name: 'name' ,mapping: 'name'},
						             { name: 'id',mapping: 'id'}
						    ]);*/
						    Ext.define('User', {
							     extend: 'Ext.data.Model',
							     fields: [
							         {name: 'departid', type: 'string'},
							         {name: 'departname',  type: 'string'}
							     ]
							 });
						     //数据源
						    /* var store = new Ext.data.Store({
						                proxy: new Ext.data.HttpProxy({
						                    url: 'http://127.0.0.1:8080/cus/info',
						                    method: 'GET' 
						                }),
						                reader: dataReader,
						                autoLoad:false
						    });*/
						   var store = Ext.create('Ext.data.Store', {
							     model: 'User',
							     proxy: {
							         type: 'ajax',
							         url: 'http://127.0.0.1:8080/purchase/getDepart',
							         reader: {
							             type: 'json',
							             root: 'data'
							         }
							     },
							     autoLoad: true
							 });
						    //store.load({params:{start:0,limit:8}});//加载数据时发送分页参数
						    console.log(store);
						     //显示栏
						  /*  var dataColumns = new Ext.grid.ColumnModel({
							    columns: [
							        new Ext.grid.RowNumberer(),//行号
							        { header: "编号",draggable:true, 
							           dataIndex: 'id',sortable: true,
							           resizable:false,
							           renderer:function(value, cellmeta, record,rowIndex){
							         		return '<a href="javascript:void(0);" title="'+value+'" onclick=alert("'+record.data.strimgname+'：girdID='+grid.getId()+'，行下标='+rowIndex+'")>'+value+'</a>';
							    	 }},
							         { header: "名称", dataIndex: 'name',resizable:false,sortable: true　}
							    ],
							    defaults: {
							        align: 'center'
							    }
							});*/
							var rightGrid = Ext.create('Ext.grid.Panel',{
								   store: store,
								   columns: [
									  {header : '部门编号', dataIndex : 'departid'},
									  {header : '部门名称', dataIndex : 'departname'}
								   ],
								   height: 200,
								   width: 400,
							});
							var leftGrid = Ext.create('Ext.grid.Panel',{
								   store: store,
								   columns: [
									  {header : '编号', dataIndex : 'id'},
									  {header : '姓名', dataIndex : 'name'}
								   ],
								   height: 200,
								   width: 400,
							});
							  var mainWindow1 = Ext.create("Ext.window.Window",{  
							        title:'单选--部门设定',  
							        height:280,  
							        width:380,  
							        constrain:true,  
							        modal:true,  
							        plain:true,  
							        autoScroll:true,      
							        closeAction: 'hide',
							        icon:'',  
							        html:'',
							        items:[{
							        	layout:'column', 
							        	labelSeparator:'：',
							        	items:[{
							        	xtype: 'combo',
							       		name: 'photo',
										editable : false,
										queryMode: "local",
										triggerAction : 'all',
										displayField: "Name",
							            valueField: "Value",
							            store:['sad','sad'],
										width:110,
							       		labelWidth: 50
							        },{
							        	xtype: 'numberfield',
							        	value: 0,
							        	minValue: 0,
							       		width:60
							        },{
							        	 xtype:"checkbox",
							        	 style:'margin-left:5px'
							        },{
							        	xtype:"displayfield",
							        	fieldLabel: '寻找同时选取',
							        	labelSeparator:''
							        },{
							        	layout: 'column',
							        	border:false,
							        	items:[{
							        		
							        	xtype: 'combo',
							       		name: 'photo',
										editable : false,
										queryMode: "local",
										triggerAction : 'all',
										displayField: "Name",
							            valueField: "Value",
							            store:['sad','sad'],
										width:150
							        },{
							        	 xtype:"button",
							        	 text:'查询',
							        },{
							        	xtype:"button",
							        	text:'刷新'
							        },{
							        	xtype:"button",
							        	width:60,
							        	style:'margin-left:6px',
							        	text:'取回'
							        	}]
							        },{
							        	layout:"column",
							        	border:false,
							        	items:[{
							        	xtype:"button",
							        	width:60,
							        	text:'全选'
							        },{
							        	xtype:"button",
							        	width:60,
							        	text:'全清'
							        },{
							        	xtype:"button",
							        	width:60,
							        	text:'以下全选'
							        },{
							        	xtype:"button",
							        	width:60,
							        	text:'以下全清'
							        },{
							        	xtype:"button",
							        	width:60,
							        	text:'新增记录'
							        },{
							        	layout:"column",
							        	border:false,
							        	items:[rightGrid]
							        }]
							        }]
							        }],
							        renderTo:Ext.getBody()  
							    });

							mainWindow1.show();
						}
					}
				}
			},{
				 xtype: 'textfield',
		        name: 'Permitter',
		        fieldLabel: '复核人员',
				style:'margin-left:19px',
				width:250,
		        labelWidth: 80,
		        anchor: '100%',
			}],
	});

var nt=Ext.create('Ext.form.Panel', {
    bodyPadding: 5,
	height:'100%',
	layout:"column",
	baseCls:'x-plain',
	items:[{
				style:'margin-left:9px;color:blue',
				xtype: 'textfield',
		        name: 'SalesMan',
		        fieldLabel: '表头条纹',
				width:250,
		        labelWidth: 80,
	        	anchor: '100%',
			},{
				 xtype: 'textfield',
		        name: 'Marker',
		        fieldLabel: '自定义栏一',
				style:'margin-left:9px',
				width:250,
		        labelWidth: 80,
		        anchor: '100%',
			},{
				 xtype: 'textfield',
		        name: 'Marker',
		        fieldLabel: '表尾头纹',
				style:'margin-left:9px',
				width:250,
		        labelWidth: 80,
		        anchor: '100%',
			},{
				 xtype: 'textfield',
		        name: 'Marker',
		        fieldLabel: '自定义栏二',
				style:'margin-left:9px',
				width:250,
		        labelWidth: 80,
		        anchor: '100%',
			},{
		        xtype     : 'textareafield',
		        style:'margin-left:9px',
		        labelWidth: 80,
		        grow      : true,
		        name      : 'message',
		        fieldLabel: '备注',
		        anchor    : '100%'
		    }
		]
});

var  tableds=Ext.create('Ext.TabPanel',{
	width:"100%",
	height:230,
	autoScroll:true,
	bodyPadding: 5,
	items:[{title:'内容',autoScroll:true,items:[filterPanel]},{title:'备注',items:[nt]}],
});
var forms=Ext.create('Ext.form.Panel', {
    bodyPadding: 5,
	height:'100%',
	layout:"column",
	baseCls:'x-plain',
	items:[
		{
			style:'margin-left:9px;color:blue',
			xtype: 'textfield',
	        name: 'Customer',
	        fieldLabel: '采购请购类型',
			width:250,
	        labelWidth: 80,
			emptyText:'采购请购类型',
	        anchor: '100%',
		},{
			style:'margin-left:9px;color:blue',
			xtype: 'datefield',
	        name: 'BillDate',
	        fieldLabel: '单据日期',
			width:250,
	        labelWidth: 70,
	        anchor: '100%',
		},{
			style:'margin-left:9px;',
			fieldLabel: '单况',
			xtype:'combo',
         	name: 'IncludeRate',
         	displayField: 'name',
			labelWidth:80,
			width:250,
			valueField: 'abbr',
			id:'notestate',
			store: Ext.create('Ext.data.Store', {
				fields: ['abbr', 'name'],
				data : [
					{"abbr":"已结案", "name":"已结案"},
					{"abbr":"无效", "name":"无效"},
					{"abbr":"未结案", "name":"未结案"}
					
			   ]
			}),
			value: '无效',
			typeAhead: true,
			mode: 'local',
			triggerAction: 'all',
			selectOnFocus:true,
		},{
			style:'margin-left:9px',
			 xtype: 'textfield',
	        name: 'BillNo',
			style:"color:blue;margin-left:9px",
	        fieldLabel: '单据号码',
			width:250,
	        labelWidth: 70,
	        anchor: '100%',
		},tableds,formsg
	]
    
	
	
});

//winform窗口
	var windowst=new  Ext.Window({
		width:640,
		title:"采购请购单（浏览...）",
		closable:true,
		resizable:false, //设置是否可以改变大小
		draggable:true,
		maximizable:true,
		minimizable:true,
		anchor: '100%',
		items:[forms],
		bbar:[
		{xtype:"splitbutton",text:'转单',width:90,menu:fielmenu2},
		{xtype:"splitbutton",text:'功能',width:90,menu:fielmenu3}],
	});
	
	var windows2=new  Ext.Window({
		width:400,
		height:300,
		title:"物料选择",
		closable:true,
		resizable:false, //设置是否可以改变大小
		draggable:true,
		closeAction:"hide",
	});
	
	function  afronction(){
		var song=Ext.encode(forms.getForm().getValues());
		Ext.Ajax.request(   
           	 {  
            //被用来向服务器发起请求默认的url  
           		 url : "",  
           	 //请求时发送后台的参数,既可以是Json对象，也可以直接使用“name = value”形式的字符串  
          		  params :[{}],  
            //请求时使用的默认的http方法  
            method : "post",  
            //请求成功时回调函数  
            success : function() {  
                Ext.ux.Toast.msg("信息提示", "成功删除所选记录！");  
            },  
            //请求失败时回调函数  
            failure : function() {  
                Ext.ux.Toast.msg("信息提示", "信息删除出错，请联系管理员!");  
            }  
        }  
    );  
				alert(song);// 序列化表单
	}
	
function fromstrn(){
	//alert(Ext.encode(forms.getForm().getValues())); 序列化表单
	
	//var record=grids.getSelectionModel().getLastSelected(); //获取选中的一行对象
	
	//	var clikd=grids.getSelectionModel().getSelected();//获取选中的一行
	
	//	var selecto=grids.getSelectionModel().getSelection(); //选中多行 返回数组
			//for(var i=0;i<selecto.length;i++){
			//	selecto[i].get('name');
			//}
			
	
	//var cout=grids.getStore().getCount(); //获取grid行数
	
	//var name=record.get('name');//获取值
	
	//for(var i=0;i<grids.store.data.length;i++){ 
		//var grit=grids.store.getAt(i).data; //获取全部值
		//	alert(grit.bianma);
		//}
//	}

	//var arr=[]; //序列化表格
			//var sni=grids.store.data;
			//sni.each(function(record){
			//arr.push(record.data);
			//})
			//alert(Ext.encode(arr));
			//}
	
  //grid.getSelectionModel().selectRow(0);//默认选中第一行
	
	//grid.getView().refresh(); //刷新表格
		
	//grids.store.removeAll();//移除全部数据
		
	//grids.store.removeAt(0); //删除指定的行
		
   //var selecto=grids.getSelectionModel().getSelection(); selecto.length>0是选中的 判断是否选中一行
		
  //var selecto=grids.getSelectionModel().getSelection();
		//var ston=grids.getStore(); 
		//var selectData=selecto[0];
		//var datainded=ston.indexOf(selectData);
		//grids.store.removeAt(datainded); //删除选中行
	
	
//	var mosld=grids.getSelectionModel().getLastSelected();
//		mosld.set('name',123); //修改选中的列
//		mosld.commit();

	}
</script>
</head>

<body>
</body>
</html>